<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì „í™”ë²ˆí˜¸ì™€ ì¸í„°ë„· ì£¼ì†Œ - ë„¤íŠ¸ì›Œí¬ í†µì‹ ì˜ ê¸°ë³¸</title>
  <style>
    /* â”€â”€ Reset & Base â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    a { text-decoration: none; }
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    /* â”€â”€ Animations â”€â”€ */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to   { transform: translateX(0);     opacity: 1; }
    }
    @keyframes signalFlow {
      0%   { opacity: 0; transform: scale(0.5); }
      50%  { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0; transform: scale(1);   }
    }
    @keyframes lineFlash {
      0%, 100% { stroke: #10b981; stroke-opacity: 0.4; stroke-width: 3; }
      50%       { stroke: #3b82f6; stroke-opacity: 1;   stroke-width: 6; }
    }
    @keyframes dashMove {
      from { stroke-dashoffset: 0; }
      to   { stroke-dashoffset: 10; }
    }
    @keyframes bounceOnce {
      0%, 100% { transform: translateY(0) translateX(-50%); }
      50%       { transform: translateY(-10px) translateX(-50%); }
    }
    .animate-pulse-custom { animation: pulse 2s ease-in-out infinite; }
    .animate-slide-in     { animation: slideIn 0.5s ease-out; }
    .signal-dot           { animation: signalFlow 1.5s ease-in-out forwards; }
    .line-flash           { animation: lineFlash 1s ease-in-out infinite; }
    .dash-move            { animation: dashMove 1s linear infinite; }

    /* â”€â”€ Layout â”€â”€ */
    .container  { max-width: 1024px; margin: 0 auto; background: #fff; border-radius: 1rem; box-shadow: 0 25px 50px rgba(0,0,0,.25); overflow: hidden; }
    .header     { background: linear-gradient(to right, #4f46e5, #9333ea); padding: 1.5rem 2rem; color: #fff; }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; }
    .header-sub { font-size: .875rem; color: #c7d2fe; }
    .btn-home   { background: #fff; color: #4f46e5; padding: .5rem 1rem; border-radius: .5rem; font-weight: 700; font-size: .875rem; border: none; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,.15); transition: background .2s; display: flex; align-items: center; gap: .5rem; }
    .btn-home:hover { background: #e0e7ff; }
    .header h1  { font-size: 1.75rem; font-weight: 700; margin-bottom: .25rem; }
    .header p   { color: #c7d2fe; }
    .content    { padding: 2rem; }

    /* â”€â”€ Cards & Boxes â”€â”€ */
    .card           { background: #fff; border-radius: .75rem; box-shadow: 0 4px 16px rgba(0,0,0,.08); border: 2px solid #e5e7eb; padding: 2rem; margin-bottom: 1.5rem; }
    .box            { border-radius: .5rem; padding: 1.5rem; margin-bottom: 1rem; }
    .box-yellow     { background: #fefce8; border: 1px solid #fde047; }
    .box-blue       { background: #eff6ff; border: 1px solid #bfdbfe; }
    .box-green      { background: #f0fdf4; border: 1px solid #bbf7d0; }
    .box-red        { background: #fef2f2; border: 1px solid #fecaca; }
    .box-indigo     { background: linear-gradient(to right, #eef2ff, #f5f3ff); border: 2px solid #a5b4fc; border-radius: .75rem; padding: 1.5rem; }
    .box-orange     { background: linear-gradient(to right, #fff7ed, #fefce8); border: 1px solid #fed7aa; border-radius: .5rem; padding: 1.5rem; }
    .box-gradient-blue  { background: linear-gradient(135deg, #eff6ff, #eef2ff); border: 2px solid #bfdbfe; border-radius: .75rem; padding: 1.5rem; }
    .box-gradient-green { background: linear-gradient(135deg, #f0fdf4, #ecfdf5); border: 2px solid #bbf7d0; border-radius: .75rem; padding: 1.5rem; }
    .inner-white    { background: #fff; border-radius: .5rem; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,.06); margin-bottom: 1rem; }

    /* â”€â”€ Typography â”€â”€ */
    .title-lg   { font-size: 1.5rem; font-weight: 700; margin-bottom: .75rem; }
    .title-md   { font-size: 1.25rem; font-weight: 700; margin-bottom: .5rem; }
    .title-sm   { font-size: 1rem;    font-weight: 700; margin-bottom: .5rem; }
    .text-lg    { font-size: 1.125rem; line-height: 1.7; }
    .text-sm    { font-size: .875rem; }
    .text-xs    { font-size: .75rem; }
    .text-mono  { font-family: monospace; }
    .bold       { font-weight: 700; }
    .text-center { text-align: center; }
    .text-blue   { color: #2563eb; }
    .text-green  { color: #059669; }
    .text-red    { color: #dc2626; }
    .text-purple { color: #7c3aed; }
    .text-orange { color: #ea580c; }
    .text-gray   { color: #6b7280; }
    .text-indigo { color: #4f46e5; }

    /* â”€â”€ Buttons â”€â”€ */
    .btn        { border: none; cursor: pointer; font-family: inherit; font-weight: 700; border-radius: .5rem; padding: 1rem 2rem; font-size: 1.125rem; transition: transform .15s, box-shadow .15s; box-shadow: 0 4px 12px rgba(0,0,0,.15); }
    .btn:hover  { transform: scale(1.03); box-shadow: 0 6px 20px rgba(0,0,0,.2); }
    .btn-primary { background: linear-gradient(to right, #4f46e5, #9333ea); color: #fff; }
    .btn-primary:hover { background: linear-gradient(to right, #4338ca, #7e22ce); }
    .btn-gray   { background: #e5e7eb; color: #374151; }
    .btn-gray:hover { background: #d1d5db; }
    .btn-blue   { background: #3b82f6; color: #fff; }
    .btn-blue:hover  { background: #2563eb; }
    .btn-green  { background: #22c55e; color: #fff; }
    .btn-green:hover { background: #16a34a; }
    .btn-purple { background: #a855f7; color: #fff; }
    .btn-purple:hover { background: #9333ea; }
    .btn-row    { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }

    /* â”€â”€ Choice Grid (step 0) â”€â”€ */
    .choice-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
    @media(max-width: 600px) { .choice-grid { grid-template-columns: 1fr; } }
    .choice-btn  { background: none; border: 2px solid; border-radius: .75rem; padding: 1.5rem; cursor: pointer; font-family: inherit; transition: transform .15s, box-shadow .15s; }
    .choice-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,0,0,.15); }
    .choice-btn .emoji { font-size: 2.5rem; display: block; margin-bottom: .5rem; }
    .choice-blue   { background: linear-gradient(135deg,#dbeafe,#bfdbfe); border-color: #93c5fd; }
    .choice-green  { background: linear-gradient(135deg,#dcfce7,#bbf7d0); border-color: #86efac; }
    .choice-purple { background: linear-gradient(135deg,#f3e8ff,#e9d5ff); border-color: #c084fc; }

    /* â”€â”€ Feedback â”€â”€ */
    .feedback-ok  { background: #f0fdf4; border: 2px solid #4ade80; border-radius: .5rem; padding: 1rem; margin-top: 1.5rem; display: flex; align-items: center; gap: .75rem; }
    .feedback-no  { background: #fff7ed; border: 2px solid #fb923c; border-radius: .5rem; padding: 1rem; margin-top: 1.5rem; display: flex; align-items: center; gap: .75rem; }

    /* â”€â”€ Two phones (step 1) â”€â”€ */
    .phones-row  { display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
    .phone-item  { text-align: center; }
    .phone-item .big { font-size: 4.5rem; display: block; }
    .cable       { flex: 1; max-width: 220px; }
    .cable-line  { height: 8px; background: linear-gradient(to right, #3b82f6, #22c55e); border-radius: 4px; }
    .cable-label { text-align: center; font-size: .75rem; color: #6b7280; margin-top: .25rem; }

    /* â”€â”€ Network call buttons (step 2) â”€â”€ */
    .call-grid   { display: grid; grid-template-columns: repeat(3, 1fr); gap: .75rem; }
    @media(max-width:600px){ .call-grid { grid-template-columns: 1fr; } }
    .call-btn    { border: none; cursor: pointer; font-family: inherit; font-weight: 700; border-radius: .5rem; padding: 1rem; font-size: .95rem; color: #fff; transition: transform .15s, box-shadow .15s; }
    .call-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,.2); }

    /* â”€â”€ IP device buttons (step 3) â”€â”€ */
    .device-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: .75rem; margin-bottom: 1rem; }
    @media(max-width:600px){ .device-grid { grid-template-columns: 1fr; } }
    .device-btn  { background: #fff; border: 2px solid #d1d5db; border-radius: .5rem; padding: .75rem; cursor: pointer; font-family: inherit; transition: transform .15s, border-color .15s; }
    .device-btn:hover  { border-color: #4ade80; transform: scale(1.05); }
    .device-btn.selected { background: #f0fdf4; border-color: #22c55e; transform: scale(1.05); }
    .device-btn .d-emoji { font-size: 2rem; display: block; margin-bottom: .25rem; }
    .device-btn .d-name  { font-size: .75rem; font-weight: 700; color: #1f2937; }
    .device-btn .d-ip    { font-size: .7rem; font-family: monospace; color: #059669; }
    .device-btn .d-tag   { font-size: .7rem; font-weight: 700; color: #15803d; margin-top: .25rem; }

    /* â”€â”€ Comparison table â”€â”€ */
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: .75rem; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: .875rem; }
    thead tr { background: linear-gradient(to right, #e0e7ff, #f3e8ff); }

    /* â”€â”€ Observation list â”€â”€ */
    .obs-list    { list-style: none; }
    .obs-list li { font-size: .875rem; color: #374151; margin-bottom: .25rem; }

    /* â”€â”€ Connection status banner â”€â”€ */
    .status-banner { border: 2px solid; border-radius: .5rem; padding: 1rem; margin-top: 1rem; display: flex; align-items: center; gap: .75rem; }
    .banner-blue   { background: #dbeafe; border-color: #60a5fa; }
    .banner-green  { background: #dcfce7; border-color: #4ade80; }

    /* â”€â”€ Misc â”€â”€ */
    .badge       { display: inline-block; border-radius: .375rem; padding: .125rem .5rem; font-size: .75rem; font-weight: 700; color: #fff; }
    .hidden      { display: none; }
    .mt1 { margin-top: .25rem; }
    .mt2 { margin-top: .5rem; }
    .mt4 { margin-top: 1rem; }
    .mt6 { margin-top: 1.5rem; }
    .mb2 { margin-bottom: .5rem; }
    .mb4 { margin-bottom: 1rem; }
    .mb6 { margin-bottom: 1.5rem; }
    .flex-center { display: flex; align-items: center; gap: .5rem; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
    @media(max-width:640px){ .grid-2 { grid-template-columns: 1fr; } }
    .tooltip-wrap { position: relative; display: inline-block; cursor: pointer; }
    .tooltip-box  { position: absolute; left: 50%; top: -3.5rem; transform: translateX(-50%);
                    background: #fbcfe8; color: #1f2937; padding: .25rem .75rem; border-radius: .75rem;
                    font-size: .875rem; font-weight: 700; white-space: nowrap; box-shadow: 0 4px 16px rgba(0,0,0,.2);
                    animation: bounceOnce .5s ease-in-out; }
    .svg-wrap     { background: #fff; border-radius: .5rem; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,.06); border: 2px solid; margin-bottom: 1rem; }
  </style>
</head>
<body>
<div class="container">
  <!-- â”€â”€ Header â”€â”€ -->
  <div class="header">
    <div class="header-top">
      <span class="header-sub">ê³ ë“±í•™êµ ì •ë³´ í•™ìŠµìë£Œ</span>
      <button class="btn-home" onclick="location.href='index.html'">ğŸ  í™ˆìœ¼ë¡œ</button>
    </div>
    <h1>ğŸ“ ì¸í„°ë„· ì£¼ì†Œê°€ ì™œ í•„ìš”í•˜ì§€?</h1>
    <p>ì¸í„°ë„·ì„ í•˜ë ¤ë©´ IP ì£¼ì†Œê°€ í•„ìš”í•´ìš”! ì–´ë–»ê²Œ ì„œë¡œë¥¼ ì°¾ì„ê¹Œìš”?</p>
  </div>

  <!-- â”€â”€ Content â”€â”€ -->
  <div class="content" id="content"></div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const state = {
  step: 0,
  answer: '',
  showFeedback: false,
  callingFrom: '', callingTo: '',
  showPhoneConn: false,
  signalPath: [],
  activeNodes: [],
  ipFrom: '', ipTo: '',
  showIPConn: false,
  showTooltip: false,
};

let signalTimer = null;

/* â”€â”€ í€´ì¦ˆ state & ë°ì´í„° â”€â”€ */
const quizState = { answers: {}, showResult: false };

const quizData = [
  {
    id: 1,
    question: '2ê°œì˜ ê¸°ê¸°(ì „í™”ê¸°/ì»´í“¨í„°)ë¥¼ ì—°ê²°í•  ë•Œ ì£¼ì†Œ(ë²ˆí˜¸)ê°€ í•„ìš”í•œê°€ìš”?',
    options: [
      'í•„ìš”í•˜ë‹¤. í•­ìƒ ì£¼ì†Œê°€ ìˆì–´ì•¼ ì—°ê²°ëœë‹¤.',
      'í•„ìš” ì—†ë‹¤. ì„ ìœ¼ë¡œ ì§ì ‘ ì—°ê²°í•˜ë©´ ìƒëŒ€ê°€ ì •í•´ì§„ë‹¤.',
      'í•„ìš”í•˜ë‹¤. ì´ì§„ìˆ˜ ì£¼ì†Œë¥¼ ì¨ì•¼ í•œë‹¤.',
      'í•„ìš” ì—†ë‹¤. ë¬´ì„ ìœ¼ë¡œë§Œ ì—°ê²°í•˜ë©´ ëœë‹¤.'
    ],
    correct: 1,
    explanation: '2ê°œë§Œ ì—°ê²°í•  ë•ŒëŠ” ì„ ìœ¼ë¡œ ì´ìœ¼ë©´ ìƒëŒ€ë°©ì´ ìë™ìœ¼ë¡œ ì •í•´ì§€ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ì£¼ì†Œ(ë²ˆí˜¸)ê°€ í•„ìš” ì—†ì–´ìš”. ì£¼ì†Œê°€ í•„ìš”í•´ì§€ëŠ” ê±´ 3ê°œ ì´ìƒë¶€í„°ì…ë‹ˆë‹¤!'
  },
  {
    id: 2,
    question: 'ì „í™”ë²ˆí˜¸(ë˜ëŠ” IP ì£¼ì†Œ)ê°€ ë°˜ë“œì‹œ í•„ìš”í•´ì§€ëŠ” ì‹œì ì€ ì–¸ì œì¸ê°€ìš”?',
    options: [
      'ê¸°ê¸°ê°€ 1ëŒ€ì¼ ë•Œ',
      'ê¸°ê¸°ê°€ 2ëŒ€ì¼ ë•Œ',
      'ê¸°ê¸°ê°€ 3ëŒ€ ì´ìƒì¼ ë•Œ',
      'ê¸°ê¸°ê°€ 100ëŒ€ ì´ìƒì¼ ë•Œ'
    ],
    correct: 2,
    explanation: '3ëŒ€ ì´ìƒì´ ë˜ë©´ "ëˆ„êµ¬ì—ê²Œ ì—°ê²°í• ì§€" êµ¬ë³„í•´ì•¼ í•´ìš”. ê·¸ë˜ì„œ ê° ê¸°ê¸°ì— ê³ ìœ í•œ ì£¼ì†Œ(ì „í™”ë²ˆí˜¸/IP ì£¼ì†Œ)ë¥¼ ë¶€ì—¬í•´ì„œ ì›í•˜ëŠ” ëŒ€ìƒì—ê²Œ ì •í™•íˆ ì—°ê²°í•©ë‹ˆë‹¤!'
  },
  {
    id: 3,
    question: 'ì „í™”ë§ì˜ êµí™˜ê¸°ì™€ ì¸í„°ë„·ì˜ ë¼ìš°í„°(Router)ëŠ” ì–´ë–¤ ê³µí†µ ì—­í• ì„ í•˜ë‚˜ìš”?',
    options: [
      'ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì—­í• ',
      'ì£¼ì†Œë¥¼ í™•ì¸í•˜ê³  ì˜¬ë°”ë¥¸ ëŒ€ìƒì—ê²Œ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ',
      'ì „ê¸° ì‹ í˜¸ë¥¼ ì´ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ì—­í• ',
      'í™”ë©´ì— ë¬¸ìë¥¼ ì¶œë ¥í•˜ëŠ” ì—­í• '
    ],
    correct: 1,
    explanation: 'êµí™˜ê¸°(ì „í™”ë§)ì™€ ë¼ìš°í„°(ì¸í„°ë„·) ëª¨ë‘ "ì£¼ì†Œë¥¼ ë³´ê³  ì˜¬ë°”ë¥¸ ëŒ€ìƒì—ê²Œ ì—°ê²°"í•´ì£¼ëŠ” ì—­í• ì„ í•´ìš”. ì „í™”ë²ˆí˜¸ë¥¼ ë³´ê³  ì—°ê²°í•˜ë©´ êµí™˜ê¸°, IP ì£¼ì†Œë¥¼ ë³´ê³  ì—°ê²°í•˜ë©´ ë¼ìš°í„°ì…ë‹ˆë‹¤!'
  },
  {
    id: 4,
    question: "IP ì£¼ì†Œ '192.168.1.10'ì—ì„œ ìˆ«ìë“¤ì€ ì–´ë–¤ ë²”ìœ„ë¡œ êµ¬ì„±ë˜ë‚˜ìš”?",
    options: [
      '0 ~ 99 ì‚¬ì´ì˜ ìˆ«ì 4ê°œ',
      '0 ~ 255 ì‚¬ì´ì˜ ìˆ«ì 4ê°œ',
      '0 ~ 999 ì‚¬ì´ì˜ ìˆ«ì 3ê°œ',
      '0 ~ 127 ì‚¬ì´ì˜ ìˆ«ì 8ê°œ'
    ],
    correct: 1,
    explanation: 'IPv4 ì£¼ì†ŒëŠ” 0~255 ì‚¬ì´ì˜ ìˆ«ì 4ê°œë¥¼ ì (.)ìœ¼ë¡œ êµ¬ë¶„í•´ì„œ í‘œí˜„í•´ìš”. ê° ìˆ«ìëŠ” 8ë¹„íŠ¸(2â¸=256ê°€ì§€)ë¡œ í‘œí˜„ë˜ê¸° ë•Œë¬¸ì— ìµœëŒ€ 255ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤!'
  },
  {
    id: 5,
    question: 'IPv4 ì£¼ì†Œê°€ ë¶€ì¡±í•´ì„œ ë‚˜ì˜¨ ìƒˆë¡œìš´ ì£¼ì†Œ ì²´ê³„ëŠ” ë¬´ì—‡ì¸ê°€ìš”?',
    options: ['IPv5', 'IPv6', 'IPmax', 'SuperIP'],
    correct: 1,
    explanation: 'IPv4ëŠ” ì•½ 43ì–µ ê°œì˜ ì£¼ì†Œë§Œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”. ì¸í„°ë„· ê¸°ê¸°ê°€ í­ë°œì ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ë©´ì„œ ì£¼ì†Œê°€ ë¶€ì¡±í•´ì¡Œê³ , IPv6ê°€ ë“±ì¥í–ˆì–´ìš”. IPv6ëŠ” 340ì¡°Ã—1ì¡°Ã—1ì¡° ê°œì˜ ì£¼ì†Œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹µë‹ˆë‹¤!'
  }
];

function handleQuizAnswer(questionId, selectedOption) {
  if (quizState.answers[questionId] !== undefined) return;
  quizState.answers[questionId] = selectedOption;
  renderQuiz();
  if (Object.keys(quizState.answers).length === quizData.length) {
    document.getElementById('quiz-submit-btn').style.display = 'block';
  }
}

function showQuizResult() {
  quizState.showResult = true;
  renderQuiz();
}

function resetQuiz() {
  quizState.answers = {};
  quizState.showResult = false;
  renderQuiz();
}

function calcScore() {
  return quizData.filter(q => quizState.answers[q.id] === q.correct).length;
}

function renderQuiz() {
  const el = document.getElementById('quiz-section');
  if (!el) return;

  if (quizState.showResult) {
    const score = calcScore();
    const total = quizData.length;
    const msg = score === total
      ? 'ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§íˆì…¨ë„¤ìš”! ğŸŠ'
      : score >= total * 0.7
      ? 'ì˜í•˜ì…¨ì–´ìš”! ì¡°ê¸ˆë§Œ ë” ë³µìŠµí•˜ë©´ ì™„ë²½í•  ê±°ì˜ˆìš”! ğŸ‘'
      : 'ë‹¤ì‹œ í•œ ë²ˆ ë³µìŠµí•´ë³´ì„¸ìš”! ğŸ’ª';

    const wrongItems = quizData.filter(q => quizState.answers[q.id] !== q.correct).map(q => `
      <div style="background:#fef2f2;padding:1rem;border-radius:.5rem;border:1px solid #fca5a5;margin-bottom:.75rem">
        <p style="font-weight:bold;color:#b91c1c;font-size:.875rem;margin-bottom:.25rem">âŒ í‹€ë¦° ë¬¸ì œ: ${q.question}</p>
        <p style="font-size:.875rem;color:#374151"><span style="font-weight:bold;color:#16a34a">ì •ë‹µ: </span>${q.options[q.correct]}</p>
        <p style="font-size:.875rem;color:#6b7280;margin-top:.25rem">${q.explanation}</p>
      </div>`).join('');

    el.innerHTML = `
      <div style="text-align:center">
        <div style="background:linear-gradient(to right,#f0fdf4,#ecfdf5);padding:2rem;border-radius:.5rem;border:1px solid #86efac;margin-bottom:1.5rem">
          <h3 style="font-size:1.5rem;font-weight:bold;color:#14532d;margin-bottom:1rem">ğŸ‰ í€´ì¦ˆ ì™„ë£Œ!</h3>
          <div style="font-size:3.5rem;font-weight:bold;color:#4f46e5;margin-bottom:1rem">${score} / ${total}</div>
          <p style="font-size:1.125rem;color:#374151">${msg}</p>
        </div>
        <div style="text-align:left;margin-bottom:1.5rem">${wrongItems}</div>
        <button onclick="resetQuiz()" style="padding:.75rem 2rem;background:linear-gradient(to right,#4f46e5,#7c3aed);color:white;font-weight:bold;border:none;border-radius:.5rem;cursor:pointer;font-size:1rem">ğŸ”„ ë‹¤ì‹œ í’€ê¸°</button>
      </div>`;
    return;
  }

  const questionsHtml = quizData.map((quiz, qIdx) => {
    const answered = quizState.answers[quiz.id] !== undefined;
    const optionsHtml = quiz.options.map((opt, oIdx) => {
      const isSelected = quizState.answers[quiz.id] === oIdx;
      const isCorrect  = quiz.correct === oIdx;
      let bg = 'background:#f9fafb;border:2px solid #e5e7eb;';
      if (answered) {
        if (isCorrect)       bg = 'background:#dcfce7;border:2px solid #4ade80;';
        else if (isSelected) bg = 'background:#fee2e2;border:2px solid #f87171;';
        else                 bg = 'background:#f9fafb;border:2px solid #e5e7eb;';
      }
      const badge = answered && isCorrect  ? '<span style="margin-left:.5rem;color:#16a34a;font-weight:bold">âœ“ ì •ë‹µ</span>' :
                    answered && isSelected && !isCorrect ? '<span style="margin-left:.5rem;color:#dc2626;font-weight:bold">âœ—</span>' : '';
      return `<button
        onclick="handleQuizAnswer(${quiz.id}, ${oIdx})"
        ${answered ? 'disabled' : ''}
        style="width:100%;text-align:left;padding:.75rem;border-radius:.5rem;${bg}cursor:${answered?'not-allowed':'pointer'};margin-bottom:.5rem;font-size:.95rem;font-family:inherit">
        ${oIdx+1}. ${opt}${badge}
      </button>`;
    }).join('');

    const explanation = answered ? `
      <div style="margin-top:1rem;padding:.75rem;background:#eff6ff;border-radius:.5rem;border:1px solid #93c5fd">
        <p style="font-size:.875rem;color:#374151"><span style="font-weight:bold;color:#2563eb">ì„¤ëª…: </span>${quiz.explanation}</p>
      </div>` : '';

    return `
      <div style="background:white;padding:1.25rem;border-radius:.5rem;border:1px solid #e5e7eb;box-shadow:0 1px 3px rgba(0,0,0,.1);margin-bottom:1rem">
        <h4 style="font-weight:bold;color:#1f2937;margin-bottom:1rem">Q${qIdx+1}. ${quiz.question}</h4>
        ${optionsHtml}
        ${explanation}
      </div>`;
  }).join('');

  const submitBtn = Object.keys(quizState.answers).length === quizData.length
    ? `<button id="quiz-submit-btn" onclick="showQuizResult()" style="width:100%;padding:1rem;background:linear-gradient(to right,#4f46e5,#7c3aed);color:white;font-weight:bold;border:none;border-radius:.5rem;cursor:pointer;font-size:1rem;margin-top:.5rem">ğŸ ê²°ê³¼ í™•ì¸í•˜ê¸°</button>`
    : `<button id="quiz-submit-btn" style="display:none"></button>`;

  el.innerHTML = questionsHtml + submitBtn;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const phones = [
  { name:'ë¯¼ìˆ˜',   number:'010-1234-5678', emoji:'ğŸ‘¦', id:'minsu'   },
  { name:'ì§€ì€',   number:'010-9876-5432', emoji:'ğŸ‘§', id:'jieun'   },
  { name:'ì„ ìƒë‹˜', number:'010-1004-1004', emoji:'ğŸ‘¨â€ğŸ«', id:'teacher' },
];
const devices = [
  { name:'í•™êµ ì»´í“¨í„°', ip:'192.168.1.10', emoji:'ğŸ’»' },
  { name:'ìŠ¤ë§ˆíŠ¸í°',   ip:'192.168.1.25', emoji:'ğŸ“±' },
  { name:'íƒœë¸”ë¦¿',     ip:'192.168.1.30', emoji:'ğŸ“²' },
];

const phonePos = { minsu:{x:150,y:100}, jieun:{x:450,y:100}, teacher:{x:300,y:330} };
const devicePos = { 'í•™êµ ì»´í“¨í„°':{x:150,y:100}, 'ìŠ¤ë§ˆíŠ¸í°':{x:450,y:100}, 'íƒœë¸”ë¦¿':{x:300,y:330} };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function svgConnections(nodes, posMap, fromKey, toKey, showConn) {
  const center = {x:300, y:200};
  return nodes.map(n => {
    const id  = n.id || n.name;
    const key = n.id || n.name;
    const pos = posMap[key];
    const active = (fromKey === key || toKey === key) && showConn;
    return `<line
      x1="${center.x}" y1="${center.y}" x2="${pos.x}" y2="${pos.y}"
      stroke="${active ? '#3b82f6' : '#d1d5db'}"
      stroke-width="${active ? 4 : 3}"
      stroke-dasharray="5,5"
      class="${active ? 'line-flash' : 'dash-move'}"
      opacity="${active ? 1 : 0.5}" />`;
  }).join('');
}

function svgSignals(fromPos, toPos) {
  const center = {x:300,y:200};
  let html = '';
  for (let i=0;i<3;i++) {
    const t = i/2;
    html += `<circle cx="${fromPos.x+(center.x-fromPos.x)*t}" cy="${fromPos.y+(center.y-fromPos.y)*t}"
      r="6" fill="#3b82f6" class="signal-dot" style="animation-delay:${i*0.15}s"/>`;
  }
  for (let i=0;i<3;i++) {
    const t = i/2;
    html += `<circle cx="${center.x+(toPos.x-center.x)*t}" cy="${center.y+(toPos.y-center.y)*t}"
      r="6" fill="#10b981" class="signal-dot" style="animation-delay:${0.5+i*0.15}s"/>`;
  }
  return html;
}

function svgNetSignals(fromPos, toPos) {
  const center = {x:300,y:200};
  let html = '';
  for (let i=0;i<3;i++) {
    const t = i/2;
    html += `<circle cx="${fromPos.x+(center.x-fromPos.x)*t}" cy="${fromPos.y+(center.y-fromPos.y)*t}"
      r="6" fill="#10b981" class="signal-dot" style="animation-delay:${i*0.15}s"/>`;
  }
  for (let i=0;i<3;i++) {
    const t = i/2;
    html += `<circle cx="${center.x+(toPos.x-center.x)*t}" cy="${center.y+(toPos.y-center.y)*t}"
      r="6" fill="#3b82f6" class="signal-dot" style="animation-delay:${0.5+i*0.15}s"/>`;
  }
  return html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STEP TEMPLATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderStep0() {
  const fb = state.showFeedback ? `
    <div class="${state.answer==='ì„ ' ? 'feedback-ok animate-slide-in' : 'feedback-no animate-slide-in'}">
      <span style="font-size:2rem">${state.answer==='ì„ ' ? 'âœ…' : 'ğŸ’­'}</span>
      <div>
        <p class="bold" style="color:${state.answer==='ì„ '?'#166534':'#9a3412'}">${state.answer==='ì„ '?'ì •ë‹µì…ë‹ˆë‹¤!':'ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!'}</p>
        <p class="text-sm" style="color:${state.answer==='ì„ '?'#15803d':'#c2410c'}">
          ${state.answer==='ì„ '
            ? 'ê·¸ë ‡ìŠµë‹ˆë‹¤! ë‘ ì „í™”ê¸°ë¥¼ ì—°ê²°í•˜ë ¤ë©´ ë¨¼ì € <strong>ì„ (ì¼€ì´ë¸”)</strong>ì´ í•„ìš”í•´ìš”!'
            : 'ë¬¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ì§€ ì•Šìœ¼ë©´ ì‹ í˜¸ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ì—†ì–´ìš”. ë‹¤ì‹œ ì„ íƒí•´ë³´ì„¸ìš”!'}
        </p>
      </div>
    </div>` : '';

  return `
    <div class="box box-yellow mb6">
      <p class="bold mb4" style="color:#713f12;font-size:1.125rem">ğŸ¤” ë¨¼ì € ìƒê°í•´ë³¼ê¹Œìš”?</p>
      <p class="text-lg" style="color:#374151">
        ì§€êµ¬ìƒì— <span class="bold text-blue">ì „í™”ê¸° 2ëŒ€</span>ë§Œ ìˆë‹¤ê³  ìƒìƒí•´ë³´ì„¸ìš”.
        ë‘ ì „í™”ê¸°ê°€ ì„œë¡œ í†µì‹ í•˜ë ¤ë©´ <span class="bold text-orange">ê°€ì¥ ë¨¼ì €</span> ë¬´ì—‡ì´ í•„ìš”í• ê¹Œìš”?
      </p>
    </div>
    <div class="card">
      <div style="display:flex;justify-content:center;align-items:center;gap:2rem;margin-bottom:2rem;flex-wrap:wrap">
        <div class="text-center"><span style="font-size:4rem">ğŸ“</span><p class="bold" style="color:#374151">ì „í™”ê¸° 1</p></div>
        <span style="font-size:3rem;color:#9ca3af">â“</span>
        <div class="text-center"><span style="font-size:4rem">ğŸ“</span><p class="bold" style="color:#374151">ì „í™”ê¸° 2</p></div>
      </div>
      <p class="text-center text-lg mb6" style="color:#374151">ë‘ ì „í™”ê¸°ë¥¼ ì—°ê²°í•˜ë ¤ë©´ ë¬´ì—‡ì´ í•„ìš”í• ê¹Œìš”?</p>
      <div class="choice-grid">
        <button class="choice-btn choice-blue"  onclick="handleAnswer('ì„ ')">
          <span class="emoji">ğŸ“¡</span><strong style="color:#1e40af">ì„  (ì¼€ì´ë¸”)</strong>
        </button>
        <button class="choice-btn choice-green" onclick="handleAnswer('ì „í™”ë²ˆí˜¸')">
          <span class="emoji">ğŸ”¢</span><strong style="color:#14532d">ì „í™”ë²ˆí˜¸</strong>
        </button>
        <button class="choice-btn choice-purple" onclick="handleAnswer('ì¸í„°ë„·')">
          <span class="emoji">ğŸŒ</span><strong style="color:#581c87">ì¸í„°ë„·</strong>
        </button>
      </div>
      ${fb}
    </div>`;
}

function renderStep1() {
  return `
    <div class="box box-green mb6 animate-slide-in">
      <div class="flex-center mb4">
        <span style="font-size:2.5rem">âœ…</span>
        <h2 class="title-lg" style="color:#166534;margin:0">ì •ë‹µ! ë¨¼ì € ì„ ì´ í•„ìš”í•©ë‹ˆë‹¤!</h2>
      </div>
      <p class="text-lg" style="color:#374151">
        ì „í™”ê¸° 2ëŒ€ê°€ í†µì‹ í•˜ë ¤ë©´ ì‹ í˜¸ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆëŠ” <span class="bold text-blue">ë¬¼ë¦¬ì  ì—°ê²°</span>ì´ í•„ìš”í•©ë‹ˆë‹¤.
      </p>
    </div>
    <div class="card">
      <h3 class="title-lg text-indigo text-center">ğŸ“¡ 2ëŒ€ì˜ ì „í™”ê¸° ì—°ê²°</h3>
      <div class="phones-row">
        <div class="phone-item">
          <span class="big">ğŸ“</span>
          <p class="bold">ì „í™”ê¸° 1</p><p class="text-sm text-gray">(ë¯¼ìˆ˜)</p>
        </div>
        <div class="cable">
          <div class="cable-line animate-pulse-custom"></div>
          <p class="cable-label">ì„  (ì¼€ì´ë¸”)</p>
        </div>
        <div class="phone-item">
          <span class="big">ğŸ“</span>
          <p class="bold">ì „í™”ê¸° 2</p><p class="text-sm text-gray">(ì§€ì€)</p>
        </div>
      </div>
      <div class="box box-blue">
        <h4 class="flex-center mb4" style="color:#1e40af"><span style="font-size:1.5rem">ğŸ’¡</span>ì§€êµ¬ìƒì— ì „í™”ê¸°ê°€ ë‹¨ 2ëŒ€ë§Œ ìˆë‹¤ë©´?</h4>
        <p style="color:#374151;margin-bottom:.5rem">âœ“ ì„ ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë‹ˆ <span class="bold text-green">ìƒëŒ€ë°©ì€ í•­ìƒ ì •í•´ì ¸</span> ìˆì–´ìš”.</p>
        <p style="color:#374151">âœ“ ê·¸ëƒ¥ ìˆ˜í™”ê¸°ë¥¼ ë“¤ë©´ <span class="bold text-purple">ìë™ìœ¼ë¡œ ìƒëŒ€ë°©ê³¼ ì—°ê²°</span>ë©ë‹ˆë‹¤.</p>
      </div>
    </div>
    <div class="box box-yellow mb6">
      <h3 class="title-md" style="color:#581c87">
        <span class="tooltip-wrap" onclick="showTooltip()">ğŸ¤”<span id="tooltip" class="tooltip-box hidden">&#xCC38;&#xC0C8;</span></span>
        ê·¸ë ‡ë‹¤ë©´ ë‹¤ìŒ ì§ˆë¬¸!
      </h3>
      <p style="color:#374151">ë§Œì•½ ì „í™”ê¸°ê°€ <span class="bold text-red">3ëŒ€ ì´ìƒ</span>ìœ¼ë¡œ ëŠ˜ì–´ë‚œë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?</p>
    </div>
    <div class="btn-row">
      <button class="btn btn-gray"    onclick="goStep(0)">â† ì´ì „ ë‹¨ê³„ë¡œ</button>
      <button class="btn btn-primary" onclick="goStep(2)">ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’</button>
    </div>`;
}

function renderStep2() {
  // SVG phone network
  const lines   = svgConnections(phones, phonePos, state.callingFrom, state.callingTo, state.showPhoneConn);
  const signals = state.signalPath.length===2
    ? svgSignals(phonePos[state.signalPath[0]], phonePos[state.signalPath[1]])
    : '';

  const nodesHtml = phones.map(p => {
    const pos = phonePos[p.id];
    const isCalling   = state.callingFrom===p.id && state.showPhoneConn;
    const isReceiving = state.callingTo===p.id   && state.showPhoneConn;
    const fill   = isCalling ? '#dbeafe' : isReceiving ? '#dcfce7' : p.id==='minsu'?'#dbeafe':p.id==='jieun'?'#dcfce7':'#f3e8ff';
    const stroke = isCalling ? '#3b82f6' : isReceiving ? '#10b981' : p.id==='minsu'?'#3b82f6':p.id==='jieun'?'#10b981':'#a855f7';
    const textC  = p.id==='minsu'?'#1e40af':p.id==='jieun'?'#065f46':'#6b21a8';
    const badgeC = p.id==='minsu'?'#3b82f6':p.id==='jieun'?'#10b981':'#a855f7';
    const labelY = p.id==='teacher' ? pos.y+45 : pos.y+40;
    return `
      <circle cx="${pos.x}" cy="${pos.y}" r="50" fill="${fill}" stroke="${stroke}" stroke-width="3"/>
      <text x="${pos.x}" y="${pos.y-5}" text-anchor="middle" dominant-baseline="middle" font-size="35">${p.emoji}</text>
      <text x="${pos.x}" y="${pos.y+30}" text-anchor="middle" font-size="14" font-weight="bold" fill="${textC}">${p.name}</text>
      <rect x="${pos.x-100}" y="${labelY}" width="200" height="30" rx="5" fill="${badgeC}"/>
      <text x="${pos.x}" y="${labelY+20}" text-anchor="middle" font-size="13" font-weight="bold" fill="white">${p.number}</text>`;
  }).join('');

  const banner = state.showPhoneConn ? `
    <div class="status-banner banner-blue animate-slide-in">
      <span style="font-size:1.5rem">ğŸ“</span>
      <div>
        <p class="bold" style="color:#1e40af">ì „í™” ì—°ê²° ì¤‘!</p>
        <p class="text-sm" style="color:#1d4ed8">ì‹ í˜¸ê°€ êµí™˜ê¸°ë¥¼ í†µí•´ ì „ì†¡ë˜ê³  ìˆì–´ìš”!
        <strong>íŒŒë€ìƒ‰ê³¼ ì´ˆë¡ìƒ‰ ì </strong>ì´ ì´ë™í•˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•˜ì„¸ìš”! ğŸ”µğŸŸ¢</p>
      </div>
    </div>` : '';

  return `
    <div class="box" style="background:linear-gradient(to right,#fff7ed,#fef2f2);border:2px solid #fb923c;border-radius:.5rem;margin-bottom:1.5rem">
      <h2 class="title-lg" style="color:#9a3412">ğŸ“ ì „í™”ê¸°ê°€ 3ëŒ€ ì´ìƒì´ë©´?</h2>
      <p class="text-lg" style="color:#374151">ì´ì œëŠ” <span class="bold text-red">ì „í™”ë²ˆí˜¸</span>ê°€ í•„ìš”í•©ë‹ˆë‹¤!</p>
    </div>
    <div class="card">
      <h3 class="title-lg text-center" style="color:#7c3aed">ğŸ”¢ 3ëª… ì´ìƒì˜ ë„¤íŠ¸ì›Œí¬</h3>
      <svg viewBox="0 0 600 400" style="width:100%;max-width:600px;display:block;margin:0 auto 1rem">
        <circle cx="300" cy="200" r="60" fill="#8b5cf6" opacity=".2"/>
        <text x="300" y="195" text-anchor="middle" font-size="20" font-weight="bold" fill="#7c3aed">ì „í™”ë§</text>
        <text x="300" y="215" text-anchor="middle" font-size="14" fill="#7c3aed">(êµí™˜ê¸°)</text>
        <line x1="300" y1="200" x2="150" y2="100" stroke="#3b82f6" stroke-width="3" stroke-dasharray="5,5" class="dash-move"/>
        <circle cx="150" cy="100" r="50" fill="#dbeafe" stroke="#3b82f6" stroke-width="3"/>
        <text x="150" y="95"  text-anchor="middle" font-size="35">ğŸ‘¦</text>
        <text x="150" y="125" text-anchor="middle" font-size="14" font-weight="bold" fill="#1e40af">ë¯¼ìˆ˜</text>
        <rect x="50" y="130" width="200" height="30" rx="5" fill="#3b82f6"/>
        <text x="150" y="150" text-anchor="middle" font-size="13" font-weight="bold" fill="white">010-1234-5678</text>
        <line x1="300" y1="200" x2="450" y2="100" stroke="#10b981" stroke-width="3" stroke-dasharray="5,5" class="dash-move"/>
        <circle cx="450" cy="100" r="50" fill="#dcfce7" stroke="#10b981" stroke-width="3"/>
        <text x="450" y="95"  text-anchor="middle" font-size="35">ğŸ‘§</text>
        <text x="450" y="125" text-anchor="middle" font-size="14" font-weight="bold" fill="#065f46">ì§€ì€</text>
        <rect x="350" y="130" width="200" height="30" rx="5" fill="#10b981"/>
        <text x="450" y="150" text-anchor="middle" font-size="13" font-weight="bold" fill="white">010-9876-5432</text>
        <line x1="300" y1="200" x2="300" y2="330" stroke="#a855f7" stroke-width="3" stroke-dasharray="5,5" class="dash-move"/>
        <circle cx="300" cy="330" r="50" fill="#f3e8ff" stroke="#a855f7" stroke-width="3"/>
        <text x="300" y="325" text-anchor="middle" font-size="35">ğŸ‘¨â€ğŸ«</text>
        <text x="300" y="355" text-anchor="middle" font-size="14" font-weight="bold" fill="#6b21a8">ì„ ìƒë‹˜</text>
        <rect x="200" y="365" width="200" height="30" rx="5" fill="#a855f7"/>
        <text x="300" y="385" text-anchor="middle" font-size="13" font-weight="bold" fill="white">010-1004-1004</text>
      </svg>
      <div class="text-center mb4">
        <p class="bold text-purple">ëª¨ë“  ì „í™”ê¸°ê°€ ì¤‘ì•™ ì „í™”ë§(êµí™˜ê¸°)ì— ì—°ê²°ë˜ì–´ ìˆì–´ìš”!</p>
        <p class="text-sm mt1" style="color:#374151">ì ì„ ì€ ê° ì „í™”ê¸°ì™€ êµí™˜ê¸°ë¥¼ ì—°ê²°í•˜ëŠ” ì„ ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>
      </div>
      <div class="box box-red">
        <h4 class="flex-center mb4" style="color:#991b1b"><span style="font-size:1.5rem">âš ï¸</span>ë¬¸ì œ ë°œìƒ!</h4>
        <p style="color:#374151;margin-bottom:.25rem">âŒ ë¯¼ìˆ˜ê°€ <span class="bold text-blue">ì§€ì€</span>ì—ê²Œë§Œ ì „í™”í•˜ê³  ì‹¶ì€ë°...</p>
        <p style="color:#374151;margin-bottom:.25rem">âŒ ì „í™”ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ <span class="bold text-red">ëˆ„êµ¬ì—ê²Œ ì—°ê²°ë ì§€ ì•Œ ìˆ˜ ì—†ì–´ìš”!</span></p>
        <p style="color:#374151">âŒ 3ëª… ëª¨ë‘ì—ê²Œ ë™ì‹œì— ì—°ê²°ë  ìˆ˜ë„ ìˆì–´ìš”</p>
      </div>
      <div class="box box-green">
        <h4 class="flex-center mb4" style="color:#166534"><span style="font-size:1.5rem">âœ…</span>í•´ê²°ì±…: ì „í™”ë²ˆí˜¸!</h4>
        <p style="color:#374151;margin-bottom:.25rem">âœ“ ê° ì „í™”ê¸°ë§ˆë‹¤ <span class="bold text-green">ê³ ìœ í•œ ë²ˆí˜¸</span>ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤</p>
        <p style="color:#374151;margin-bottom:.25rem">âœ“ ë¯¼ìˆ˜ê°€ ì§€ì€ì—ê²Œ ì „í™”í•˜ë ¤ë©´ <span class="text-mono bold text-blue">010-9876-5432</span>ë¥¼ ëˆ„ë¦…ë‹ˆë‹¤</p>
        <p style="color:#374151;margin-bottom:.5rem">âœ“ ì „í™”ë§ì´ ì´ ë²ˆí˜¸ë¥¼ ë³´ê³  <span class="bold text-purple">ì •í™•íˆ ì§€ì€ì—ê²Œë§Œ ì—°ê²°</span>í•´ì¤ë‹ˆë‹¤</p>
        <p class="bold text-orange">â†’ 3ëª… ì´ìƒì´ë©´ ëˆ„êµ¬ì—ê²Œ ì „í™”í• ì§€ êµ¬ë³„í•˜ê¸° ìœ„í•´ ì „í™”ë²ˆí˜¸ê°€ í•„ìˆ˜ì…ë‹ˆë‹¤!</p>
      </div>
    </div>

    <!-- ì „í™” ê±¸ê¸° ì²´í—˜ -->
    <div class="box-gradient-blue mb6">
      <h2 class="title-lg flex-center" style="color:#1d4ed8">ğŸ“ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì „í™” ê±¸ê¸° ì²´í—˜</h2>
      <div class="box box-yellow mb4 text-sm">
        ğŸ’¡ <strong>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­</strong>í•´ì„œ ì‹ í˜¸ê°€ ì „ì†¡ë˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•˜ì„¸ìš”! ğŸ”µ
      </div>
      <div class="svg-wrap" style="border-color:#bfdbfe">
        <svg viewBox="0 0 600 430" style="width:100%;max-width:600px;display:block;margin:0 auto">
          ${lines}${signals}
          <circle cx="300" cy="200" r="60" fill="#8b5cf6" opacity=".2"/>
          <text x="300" y="195" text-anchor="middle" font-size="20" font-weight="bold" fill="#7c3aed">ì „í™”ë§</text>
          <text x="300" y="215" text-anchor="middle" font-size="14" fill="#7c3aed">(êµí™˜ê¸°)</text>
          ${nodesHtml}
        </svg>
      </div>
      <div class="call-grid mb4">
        <button class="call-btn" style="background:#3b82f6" onclick="handlePhoneCall('teacher','minsu')">ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜ â†’ ğŸ‘¦ ë¯¼ìˆ˜</button>
        <button class="call-btn" style="background:#22c55e" onclick="handlePhoneCall('minsu','jieun')">ğŸ‘¦ ë¯¼ìˆ˜ â†’ ğŸ‘§ ì§€ì€</button>
        <button class="call-btn" style="background:#a855f7" onclick="handlePhoneCall('jieun','teacher')">ğŸ‘§ ì§€ì€ â†’ ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜</button>
      </div>
      ${banner}
      <div class="box box-indigo mt4">
        <p class="text-sm bold mb2" style="color:#4338ca">ğŸ’¡ ê´€ì°°í•´ë³´ì„¸ìš”!</p>
        <ul class="obs-list">
          <li>â€¢ <span class="bold text-blue">íŒŒë€ìƒ‰ ì </span>: ë°œì‹ ìì—ì„œ êµí™˜ê¸°ë¡œ ê°€ëŠ” ì‹ í˜¸</li>
          <li>â€¢ <span class="bold text-green">ì´ˆë¡ìƒ‰ ì </span>: êµí™˜ê¸°ì—ì„œ ìˆ˜ì‹ ìë¡œ ê°€ëŠ” ì‹ í˜¸</li>
          <li>â€¢ <span class="bold text-purple">êµí™˜ê¸°</span>: ì „í™”ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³  ì˜¬ë°”ë¥¸ ì‚¬ëŒì—ê²Œ ì—°ê²°</li>
          <li>â€¢ <span class="bold">ì „í™”ë²ˆí˜¸</span> ë•ë¶„ì— ì •í™•í•œ ì‚¬ëŒì—ê²Œ ì—°ê²°ë¼ìš”!</li>
        </ul>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-gray"    onclick="goStep(1)">â† ì´ì „ ë‹¨ê³„ë¡œ</button>
      <button class="btn btn-primary" onclick="goStep(3)">ì¸í„°ë„·ë„ ê°™ì€ ì›ë¦¬! â†’</button>
    </div>`;
}

function renderStep3() {
  const lines   = svgConnections(devices, devicePos, state.ipFrom, state.ipTo, state.showIPConn);
  const signals = state.signalPath.length===2
    ? svgNetSignals(devicePos[state.signalPath[0]], devicePos[state.signalPath[1]])
    : '';

  const devicesHtml = devices.map(d => {
    const pos = devicePos[d.name];
    const isSender  = state.ipFrom===d.name && !state.showIPConn;
    const isActive  = state.activeNodes.includes(d.name);
    const fill   = isSender ? '#fbbf24' : isActive ? '#10b981' : '#e0e7ff';
    const stroke = isSender ? '#f59e0b' : isActive ? '#059669' : '#6366f1';
    return `
      <circle cx="${pos.x}" cy="${pos.y}" r="35" fill="${fill}" stroke="${stroke}" stroke-width="3"/>
      <text x="${pos.x}" y="${pos.y}" text-anchor="middle" dominant-baseline="middle" font-size="28">${d.emoji}</text>
      <text x="${pos.x}" y="${pos.y+50}" text-anchor="middle" font-size="14" font-weight="bold" fill="#1f2937">${d.name}</text>
      <text x="${pos.x}" y="${pos.y+68}" text-anchor="middle" font-size="14" font-family="monospace" fill="#059669" font-weight="bold">${d.ip}</text>`;
  }).join('');

  const deviceBtns = devices.map(d => `
    <button class="device-btn ${state.ipFrom===d.name?'selected':''}" onclick="handleDeviceClick('${d.name}')">
      <span class="d-emoji">${d.emoji}</span>
      <span class="d-name">${d.name}</span>
      <span class="d-ip">${d.ip}</span>
      ${state.ipFrom===d.name ? '<span class="d-tag">ì†¡ì‹ ì ì„ íƒë¨ âœ“</span>' : ''}
    </button>`).join('');

  const ipBanner = state.showIPConn ? `
    <div class="status-banner banner-green animate-slide-in mb4">
      <span style="font-size:1.5rem">âœ…</span>
      <div>
        <p class="bold" style="color:#166534">ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì¤‘!</p>
        <p class="text-sm" style="color:#15803d">
          <strong>${state.ipFrom}</strong>ì—ì„œ <strong>${state.ipTo}</strong>ë¡œ ë°ì´í„°ê°€ ì „ì†¡ë˜ê³  ìˆì–´ìš”!
          <strong>ì´ˆë¡ìƒ‰ ì ê³¼ íŒŒë€ìƒ‰ ì </strong>ì´ ë¼ìš°í„°ë¥¼ í†µí•´ ì´ë™í•˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•˜ì„¸ìš”! ğŸŸ¢ğŸ”µ
        </p>
      </div>
    </div>` : '';

  const hint = state.ipFrom
    ? `<p class="text-sm text-center mt4">âœ… <strong class="text-green">${state.ipFrom}</strong> ì„ íƒë¨! ì´ì œ <strong class="text-blue">ìˆ˜ì‹ ì ê¸°ê¸°</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>`
    : `<p class="text-sm text-center mt4">ğŸ’¡ <strong>ì†¡ì‹ ì ê¸°ê¸°</strong>ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!</p>`;

  return `
    <div class="box box-green mb6">
      <h2 class="title-lg" style="color:#166534">ğŸŒ ì¸í„°ë„·ë„ ë˜‘ê°™ì•„ìš”!</h2>
      <p class="text-lg" style="color:#374151">
        ì¸í„°ë„·ë„ ì „í™”ì™€ ê°™ì€ ì›ë¦¬ì…ë‹ˆë‹¤. ë¨¼ì € <span class="bold text-blue">ì„ (ì¼€ì´ë¸”, Wi-Fi)</span>ìœ¼ë¡œ ì—°ê²°í•˜ê³ ,
        ì—¬ëŸ¬ ê¸°ê¸°ë¥¼ êµ¬ë³„í•˜ê¸° ìœ„í•´ <span class="bold text-green">IP ì£¼ì†Œ</span>ë¥¼ ì‚¬ìš©í•´ìš”!
      </p>
    </div>

    <div class="grid-2 mb6">
      <div class="card" style="border-color:#bfdbfe">
        <h3 class="title-md text-blue">ğŸ“ ì „í™” í†µì‹ </h3>
        <p style="color:#374151;margin-bottom:.5rem">1ï¸âƒ£ <span class="bold text-blue">ì „í™”ì„ </span>ìœ¼ë¡œ ì—°ê²°</p>
        <p style="color:#374151;margin-bottom:.5rem">2ï¸âƒ£ <span class="bold text-green">ì „í™”ë²ˆí˜¸</span>ë¡œ ìƒëŒ€ êµ¬ë³„</p>
        <p style="color:#374151">3ï¸âƒ£ ì˜ˆ: <span class="text-mono">010-1234-5678</span></p>
      </div>
      <div class="card" style="border-color:#bbf7d0">
        <h3 class="title-md text-green">ğŸŒ ì¸í„°ë„· í†µì‹ </h3>
        <p style="color:#374151;margin-bottom:.5rem">1ï¸âƒ£ <span class="bold text-blue">ë„¤íŠ¸ì›Œí¬ ì„ </span>ìœ¼ë¡œ ì—°ê²° (ì¼€ì´ë¸”/Wi-Fi)</p>
        <p style="color:#374151;margin-bottom:.5rem">2ï¸âƒ£ <span class="bold text-green">IP ì£¼ì†Œ</span>ë¡œ ê¸°ê¸° êµ¬ë³„</p>
        <p style="color:#374151">3ï¸âƒ£ ì˜ˆ: <span class="text-mono">192.168.1.10</span></p>
      </div>
    </div>

    <!-- IP ì£¼ì†Œ ì²´í—˜ -->
    <div class="box-gradient-green mb6">
      <h2 class="title-lg flex-center" style="color:#15803d">ğŸŒ IP ì£¼ì†Œë¡œ ì—°ê²°í•˜ê¸°</h2>
      <div class="box box-yellow mb4 text-sm">
        ğŸ’¡ ì–´ë–»ê²Œ ì—°ê²°í• ê¹Œìš”? <span class="bold text-green">ì†¡ì‹ ì ê¸°ê¸°ë¥¼ ì„ íƒ</span>í•œ í›„
        <span class="bold text-blue">ìˆ˜ì‹ ì ê¸°ê¸°</span>ë¥¼ í´ë¦­í•´ì„œ ì—°ê²°í•´ë³´ì„¸ìš”!
      </div>
      <div class="device-grid">${deviceBtns}</div>
      <div class="svg-wrap" style="border-color:#bbf7d0">
        <svg viewBox="0 0 600 400" style="width:100%;max-width:600px;display:block;margin:0 auto">
          ${lines}
          <circle cx="300" cy="200" r="40" fill="#8b5cf6" stroke="#6d28d9" stroke-width="3"/>
          <text x="300" y="200" text-anchor="middle" dominant-baseline="middle" font-size="30">ğŸ”€</text>
          <text x="300" y="255" text-anchor="middle" font-size="14" font-weight="bold" fill="#6d28d9">ë¼ìš°í„°</text>
          <text x="300" y="273" text-anchor="middle" font-size="14" fill="#7c3aed">(IP ì£¼ì†Œ í™•ì¸)</text>
          ${devicesHtml}${signals}
        </svg>
        ${hint}
      </div>
      ${ipBanner}
      <div class="box box-green">
        <p class="text-sm bold mb2 text-green">ğŸ’¡ ê´€ì°°í•´ë³´ì„¸ìš”!</p>
        <ul class="obs-list">
          <li>â€¢ <span class="bold text-green">ì´ˆë¡ìƒ‰ ì </span>: ì†¡ì‹ ì ê¸°ê¸°ì—ì„œ ë¼ìš°í„°ë¡œ ê°€ëŠ” ì‹ í˜¸</li>
          <li>â€¢ <span class="bold text-blue">íŒŒë€ìƒ‰ ì </span>: ë¼ìš°í„°ì—ì„œ ìˆ˜ì‹ ì ê¸°ê¸°ë¡œ ê°€ëŠ” ì‹ í˜¸</li>
          <li>â€¢ <span class="bold text-purple">ë¼ìš°í„°</span>: IP ì£¼ì†Œë¥¼ í™•ì¸í•˜ê³  ì˜¬ë°”ë¥¸ ê¸°ê¸°ì— ì—°ê²°</li>
          <li>â€¢ <span class="bold">IP ì£¼ì†Œ</span> ë•ë¶„ì— ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìê°€ ì •í™•íˆ ì—°ê²°ë¼ìš”!</li>
          <li>â€¢ ì „í™”ì˜ <span class="bold text-blue">êµí™˜ê¸°</span>ì™€ ì¸í„°ë„·ì˜ <span class="bold text-purple">ë¼ìš°í„°</span>ëŠ” ê°™ì€ ì—­í• !</li>
        </ul>
      </div>
    </div>

    <!-- ë¹„êµí‘œ -->
    <div class="card mb6">
      <h2 class="title-lg text-purple mb4">ğŸ“Š ì „í™”ë²ˆí˜¸ vs IP ì£¼ì†Œ</h2>
      <div style="overflow-x:auto">
        <table>
          <thead><tr><th>êµ¬ë¶„</th><th style="color:#1d4ed8">ğŸ“ ì „í™”ë²ˆí˜¸</th><th style="color:#15803d">ğŸŒ IP ì£¼ì†Œ</th></tr></thead>
          <tbody>
            <tr><td class="bold">ë¬¼ë¦¬ì  ì—°ê²°</td><td>ì „í™”ì„  (ìœ ì„ /ë¬´ì„ )</td><td>ë„¤íŠ¸ì›Œí¬ ì¼€ì´ë¸” / Wi-Fi</td></tr>
            <tr style="background:#f9fafb"><td class="bold">ì£¼ì†Œ ì—­í• </td><td>ì „í™”ê¸°ë¥¼ êµ¬ë³„</td><td>ì¸í„°ë„· ê¸°ê¸°ë¥¼ êµ¬ë³„</td></tr>
            <tr><td class="bold">í˜•ì‹</td><td class="text-mono">010-1234-5678</td><td class="text-mono">192.168.1.10</td></tr>
            <tr style="background:#f9fafb"><td class="bold">ëŒ€ìƒ</td><td>ì‚¬ëŒ (ì „í™”ê¸°)</td><td>ê¸°ê¸° (ì»´í“¨í„°, ìŠ¤ë§ˆíŠ¸í° ë“±)</td></tr>
            <tr><td class="bold">í•„ìš”í•œ ì‹œì </td><td>3ëª… ì´ìƒì˜ ì „í™”ê¸°</td><td>3ê°œ ì´ìƒì˜ ì¸í„°ë„· ê¸°ê¸°</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ì¬ë¯¸ìˆëŠ” ì‚¬ì‹¤ -->
    <div class="box-orange mb6">
      <h3 class="title-md" style="color:#9a3412">ğŸ’¡ ì¬ë¯¸ìˆëŠ” ì‚¬ì‹¤</h3>
      <div class="inner-white">
        <p class="text-lg" style="color:#374151;margin-bottom:1rem">
          ì „ ì„¸ê³„ ì¸í„°ë„·ì— ì—°ê²°ëœ ê¸°ê¸°ëŠ” <span class="bold text-red" style="font-size:1.25rem">ì•½ 500ì–µ ê°œ</span>ê°€ ë„˜ì–´ìš”!
          ì´ ëª¨ë“  ê¸°ê¸°ê°€ ê°ì ê³ ìœ í•œ IP ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆë‹µë‹ˆë‹¤. ğŸŒ
        </p>
        <div class="box box-blue">
          <p class="text-sm mb2"><strong class="text-blue">IPv4:</strong> ìš°ë¦¬ê°€ ë°°ìš´ 192.168.1.10 ê°™ì€ í˜•ì‹ìœ¼ë¡œ,
          ì•½ <span class="bold text-blue">43ì–µ ê°œ</span>ì˜ ì£¼ì†Œë¥¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.</p>
          <p class="text-sm"><strong class="text-green">IPv6:</strong> ê¸°ê¸°ê°€ ë„ˆë¬´ ë§ì•„ì ¸ì„œ ìƒˆë¡œìš´ í˜•ì‹ì´ ë‚˜ì™”ì–´ìš”!
          2001:0db8:85a3::8a2e:0370:7334 ê°™ì€ í˜•ì‹ìœ¼ë¡œ,
          <span class="bold text-green">340ì¡°Ã—1ì¡°Ã—1ì¡° ê°œ</span>ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹µë‹ˆë‹¤! ì§€êµ¬ì˜ ëª¨ë˜ì•Œë³´ë‹¤ ë§ì•„ìš”! ğŸ–ï¸</p>
        </div>
      </div>
    </div>

    <!-- í•µì‹¬ ì •ë¦¬ -->
    <div class="box-indigo mb6">
      <h3 class="title-lg flex-center" style="color:#3730a3"><span style="font-size:1.75rem">ğŸ’¡</span>í•µì‹¬ ì •ë¦¬</h3>
      <div class="inner-white mb4">
        <p class="bold mb2 text-blue">1ï¸âƒ£ 2ê°œë§Œ ìˆì„ ë•Œ</p>
        <p style="color:#374151">ì„ ìœ¼ë¡œ ì—°ê²°í•˜ë©´ ë! ì£¼ì†Œ(ë²ˆí˜¸)ëŠ” í•„ìš” ì—†ì–´ìš”. <span class="bold text-orange">ìƒëŒ€ê°€ ì´ë¯¸ ì •í•´ì ¸ ìˆìœ¼ë‹ˆê¹Œìš”.</span></p>
      </div>
      <div class="inner-white mb4">
        <p class="bold mb2 text-green">2ï¸âƒ£ 3ê°œ ì´ìƒì¼ ë•Œ</p>
        <p style="color:#374151">ì„ ìœ¼ë¡œ ì—°ê²°í•œ í›„, ê°ê°ì—ê²Œ <span class="bold text-green">ê³ ìœ í•œ ì£¼ì†Œ(ì „í™”ë²ˆí˜¸/IP ì£¼ì†Œ)</span>ë¥¼ ë¶€ì—¬í•´ìš”. ê·¸ë˜ì•¼ ì›í•˜ëŠ” ëŒ€ìƒì—ê²Œë§Œ ì •í™•íˆ ì—°ê²°í•  ìˆ˜ ìˆì–´ìš”!</p>
      </div>
      <div class="inner-white">
        <p class="bold mb2 text-purple">3ï¸âƒ£ ê³µí†µì </p>
        <p style="color:#374151">ì „í™”ë“  ì¸í„°ë„·ì´ë“  <span class="bold text-blue">â‘ ë¨¼ì € ë¬¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°</span>í•˜ê³ , <span class="bold text-green">â‘¡ì—¬ëŸ¬ ê°œë©´ ì£¼ì†Œë¡œ êµ¬ë³„</span>í•©ë‹ˆë‹¤!</p>
      </div>
    </div>

    <!-- í€´ì¦ˆ ì„¹ì…˜ -->
    <div style="background:linear-gradient(to right,#faf5ff,#fdf2f8);padding:1.25rem;border-radius:.5rem;border:1px solid #d8b4fe;margin-top:1.5rem;margin-bottom:1.5rem">
      <h3 style="font-size:1.125rem;font-weight:bold;color:#581c87;margin-bottom:1rem">ğŸ¯ ë°°ìš´ ë‚´ìš© í™•ì¸í•˜ê¸°</h3>
      <div id="quiz-section"></div>
    </div>

    <div class="btn-row">
      <button class="btn btn-gray" onclick="goStep(2)">â† ì´ì „ ë‹¨ê³„ë¡œ</button>
      <button class="btn btn-primary" onclick="location.href='index.html'">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const el = document.getElementById('content');
  if      (state.step===0) el.innerHTML = renderStep0();
  else if (state.step===1) el.innerHTML = renderStep1();
  else if (state.step===2) el.innerHTML = renderStep2();
  else if (state.step===3) { el.innerHTML = renderStep3(); renderQuiz(); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT HANDLERS (global, called from onclick)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goStep(n) {
  state.step = n;
  // reset connection state when navigating
  state.showPhoneConn = false; state.callingFrom=''; state.callingTo='';
  state.showIPConn    = false; state.ipFrom='';      state.ipTo='';
  state.signalPath=[]; state.activeNodes=[];
  if (signalTimer) { clearTimeout(signalTimer); signalTimer=null; }
  render();
  window.scrollTo({top:0, behavior:'smooth'});
}

function handleAnswer(ans) {
  state.answer = ans;
  state.showFeedback = true;
  render();
  if (ans==='ì„ ') {
    setTimeout(() => { state.step=1; state.showFeedback=false; render(); }, 1000);
  }
}

function showTooltip() {
  const el = document.getElementById('tooltip');
  if (!el) return;
  el.classList.remove('hidden');
  setTimeout(() => { el.classList.add('hidden'); }, 400);
}

function handlePhoneCall(fromId, toId) {
  if (signalTimer) clearTimeout(signalTimer);
  state.callingFrom=fromId; state.callingTo=toId;
  state.showPhoneConn=true;
  state.activeNodes=[fromId,toId];
  setTimeout(() => { state.signalPath=[fromId,toId]; render(); }, 300);
  signalTimer = setTimeout(() => {
    state.showPhoneConn=false; state.callingFrom=''; state.callingTo='';
    state.signalPath=[]; state.activeNodes=[];
    render();
  }, 3000);
  render();
}

function handleDeviceClick(name) {
  if (!state.ipFrom) {
    state.ipFrom = name;
    render();
  } else if (name !== state.ipFrom) {
    if (signalTimer) clearTimeout(signalTimer);
    const from = state.ipFrom;
    state.ipTo = name;
    state.showIPConn = true;
    state.activeNodes = [from, name];
    setTimeout(() => { state.signalPath=[from, name]; render(); }, 300);
    signalTimer = setTimeout(() => {
      state.showIPConn=false; state.ipFrom=''; state.ipTo='';
      state.activeNodes=[]; state.signalPath=[];
      render();
    }, 3000);
    render();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
render();
</script>
</body>
</html>
